<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICE Activity Monitor - Live Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Anybody:wght@300;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --warning-red: #DC2626;
            --alert-orange: #F97316;
            --safe-green: #10B981;
            --bg-dark: #0A0A0A;
            --bg-card: #1A1A1A;
            --text-primary: #FAFAFA;
            --text-secondary: #A3A3A3;
            --border-color: #2A2A2A;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Mono', monospace;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 2rem;
        }

        .disclaimer {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.1), rgba(249, 115, 22, 0.1));
            border: 2px solid var(--warning-red);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            font-size: 0.85rem;
            line-height: 1.6;
        }

        .disclaimer h3 {
            font-family: 'Anybody', sans-serif;
            font-weight: 800;
            color: var(--warning-red);
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .disclaimer p {
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        .disclaimer strong {
            color: var(--text-primary);
        }

        header {
            margin-bottom: 3rem;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 2rem;
        }

        h1 {
            font-family: 'Anybody', sans-serif;
            font-weight: 800;
            font-size: 3rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--warning-red), var(--alert-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            font-weight: 300;
        }

        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(220, 38, 38, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            margin-top: 1rem;
            font-size: 0.85rem;
        }

        .pulse-dot {
            width: 8px;
            height: 8px;
            background: var(--warning-red);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            transition: transform 0.2s, border-color 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            border-color: var(--warning-red);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-family: 'Anybody', sans-serif;
            font-weight: 700;
            font-size: 2.5rem;
            color: var(--text-primary);
        }

        .activity-table {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }

        .table-header {
            background: rgba(220, 38, 38, 0.1);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .table-title {
            font-family: 'Anybody', sans-serif;
            font-weight: 700;
            font-size: 1.25rem;
        }

        .refresh-btn {
            background: var(--warning-red);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            transition: background 0.2s;
        }

        .refresh-btn:hover {
            background: #B91C1C;
        }

        .activity-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .activity-item {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 1rem;
            align-items: start;
            transition: background 0.2s;
        }

        .activity-item:hover {
            background: rgba(220, 38, 38, 0.05);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .badge-abduction {
            background: rgba(220, 38, 38, 0.2);
            color: var(--warning-red);
        }

        .badge-threat {
            background: rgba(249, 115, 22, 0.2);
            color: var(--alert-orange);
        }

        .badge-observed {
            background: rgba(163, 163, 163, 0.2);
            color: var(--text-secondary);
        }

        .activity-details h4 {
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
            color: var(--text-primary);
        }

        .activity-meta {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .activity-description {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .verification-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 700;
        }

        .verified {
            background: rgba(16, 185, 129, 0.2);
            color: var(--safe-green);
        }

        .likely {
            background: rgba(249, 115, 22, 0.2);
            color: var(--alert-orange);
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .error {
            background: rgba(220, 38, 38, 0.1);
            border: 2px solid var(--warning-red);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            color: var(--warning-red);
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            h1 {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .activity-item {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="disclaimer">
        <h3>⚠️ Important Legal Disclaimer</h3>
        <p><strong>FOR INFORMATIONAL AND EDUCATIONAL PURPOSES ONLY.</strong> This dashboard displays community-reported data and is provided "as-is" without any warranties or guarantees of accuracy, completeness, or reliability.</p>
        <p><strong>NOT FOR SAFETY DECISIONS:</strong> This information should NOT be used as the sole basis for any safety, legal, or personal decisions. Data may be incomplete, outdated, or inaccurate.</p>
        <p><strong>NO LIABILITY:</strong> The creator(s) of this dashboard assume no responsibility or liability for any actions taken based on this information, including but not limited to personal injury, property damage, or legal consequences.</p>
        <p><strong>USE AT YOUR OWN RISK:</strong> By viewing this dashboard, you acknowledge that you use this information entirely at your own risk and agree to indemnify and hold harmless the creator(s) from any claims arising from your use of this data.</p>
    </div>

    <header>
        <h1>ICE Activity Monitor</h1>
        <p class="subtitle">Live community-reported activity dashboard</p>
        <div class="live-indicator">
            <div class="pulse-dot"></div>
            <span>LIVE DATA</span>
        </div>
    </header>

    <div class="stats-grid" id="statsGrid">
        <div class="stat-card">
            <div class="stat-label">Total Incidents</div>
            <div class="stat-value" id="totalIncidents">—</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Last 24 Hours</div>
            <div class="stat-value" id="last24Hours">—</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Confirmed Reports</div>
            <div class="stat-value" id="confirmedReports">—</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Most Active City</div>
            <div class="stat-value" id="mostActiveCity" style="font-size: 1.5rem;">—</div>
        </div>
    </div>

    <div class="activity-table">
        <div class="table-header">
            <div class="table-title">Recent Activity</div>
            <button class="refresh-btn" onclick="loadData()">Refresh Data</button>
        </div>
        <div id="activityList" class="activity-list">
            <div class="loading">Loading data from Airtable...</div>
        </div>
    </div>

    <script>
        // CONFIGURATION - You'll need to set up Airtable API access
        const AIRTABLE_CONFIG = {
            // To get this working, you need to:
            // 1. Go to https://airtable.com/create/tokens
            // 2. Create a personal access token with read access to your base
            // 3. Replace YOUR_API_KEY below
            apiKey: 'pat4Wu1xZwnJjLXpU.95d481c0aa858c4c730cbd8b4933dd0d8c7045f636b7180310e06f29bee6162e',
            baseId: 'appAmfaJz2c5aR2zA',
            tableName: 'Activity Data' // Replace with your actual table name
        };

        async function loadData() {
            const activityList = document.getElementById('activityList');
            activityList.innerHTML = '<div class="loading">Loading data from Airtable...</div>';

            try {
                // For demo purposes, using sample data structure
                // Replace this with actual Airtable API call when you have your API key
                
                if (AIRTABLE_CONFIG.apiKey === 'YOUR_API_KEY_HERE') {
                    activityList.innerHTML = `
                        <div class="error">
                            <h3>⚠️ API Key Required</h3>
                            <p>To connect to your Airtable:</p>
                            <ol style="text-align: left; max-width: 500px; margin: 1rem auto; line-height: 1.8;">
                                <li>Go to <a href="https://airtable.com/create/tokens" target="_blank" style="color: var(--alert-orange);">airtable.com/create/tokens</a></li>
                                <li>Create a personal access token</li>
                                <li>Give it read access to your base</li>
                                <li>Replace 'YOUR_API_KEY_HERE' in the code with your token</li>
                                <li>Also update the tableName in AIRTABLE_CONFIG if needed</li>
                            </ol>
                        </div>
                    `;
                    return;
                }

                const response = await fetch(
                    `https://api.airtable.com/v0/${AIRTABLE_CONFIG.baseId}/${encodeURIComponent(AIRTABLE_CONFIG.tableName)}?sort[0][field]=activity_date&sort[0][direction]=desc&maxRecords=50`,
                    {
                        headers: {
                            'Authorization': `Bearer ${AIRTABLE_CONFIG.apiKey}`
                        }
                    }
                );

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const data = await response.json();
                displayData(data.records);
                
            } catch (error) {
                console.error('Error loading data:', error);
                activityList.innerHTML = `
                    <div class="error">
                        <h3>Error Loading Data</h3>
                        <p>${error.message}</p>
                        <p style="margin-top: 1rem; font-size: 0.85rem;">Check console for details</p>
                    </div>
                `;
            }
        }

        function displayData(records) {
            const activityList = document.getElementById('activityList');
            
            if (records.length === 0) {
                activityList.innerHTML = '<div class="loading">No data available</div>';
                return;
            }

            // Calculate stats
            updateStats(records);

            // Display activity items
            activityList.innerHTML = records.map(record => {
                const fields = record.fields;
                const activityType = fields.simplified_activity || 'Unknown';
                const badgeClass = getBadgeClass(activityType);
                const verificationClass = getVerificationClass(fields.veracity);
                
                return `
                    <div class="activity-item">
                        <div class="activity-badge ${badgeClass}">
                            ${activityType}
                        </div>
                        <div class="activity-details">
                            <h4>${fields.city || 'Unknown Location'}, ${fields.county || ''}</h4>
                            <div class="activity-meta">
                                ${formatDate(fields.activity_date)} • ${fields.hour_of_day_str || 'Time unknown'}
                                ${fields.location_name ? ` • ${fields.location_name}` : ''}
                            </div>
                            ${fields.additional_description ? `<div class="activity-description">${fields.additional_description}</div>` : ''}
                        </div>
                        <div class="verification-badge ${verificationClass}">
                            ${fields.veracity || 'Unverified'}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateStats(records) {
            document.getElementById('totalIncidents').textContent = records.length;

            // Last 24 hours
            const oneDayAgo = new Date();
            oneDayAgo.setDate(oneDayAgo.getDate() - 1);
            const recent = records.filter(r => new Date(r.fields.activity_date) > oneDayAgo);
            document.getElementById('last24Hours').textContent = recent.length;

            // Confirmed reports
            const confirmed = records.filter(r => 
                r.fields.veracity === 'Confirmed' || r.fields.veracity === 'Verified'
            );
            document.getElementById('confirmedReports').textContent = confirmed.length;

            // Most active city
            const cityCounts = {};
            records.forEach(r => {
                const city = r.fields.city;
                if (city) cityCounts[city] = (cityCounts[city] || 0) + 1;
            });
            const mostActive = Object.entries(cityCounts).sort((a, b) => b[1] - a[1])[0];
            document.getElementById('mostActiveCity').textContent = mostActive ? mostActive[0] : '—';
        }

        function getBadgeClass(activityType) {
            if (activityType.includes('Abduction')) return 'badge-abduction';
            if (activityType.includes('Threat')) return 'badge-threat';
            return 'badge-observed';
        }

        function getVerificationClass(veracity) {
            if (veracity === 'Confirmed' || veracity === 'Verified') return 'verified';
            if (veracity === 'Likely' || veracity === 'Very Likely') return 'likely';
            return '';
        }

        function formatDate(dateStr) {
            if (!dateStr) return 'Date unknown';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric',
                year: 'numeric'
            });
        }

        // Auto-refresh every 5 minutes
        setInterval(loadData, 5 * 60 * 1000);

        // Load data on page load
        loadData();
    </script>
</body>
</html>
